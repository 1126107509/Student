<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="studentTracking.dao.IStudentDao">
    <sql id="baseSql">
        SELECT
            s.stuId,
            s.stuName,
            s.sex,
            s.nation,
            s.birthday,
            s.birthPlace,
            s.marry,
            s.telephone,
            s.idcard,
            s.email,
            s.university,
            s.major,
            s.photo,
            s.note,
            s.state,
            s.classId,
            s.deptId
    </sql>
    <!--Student getStuInform(long peopleId)-->
    <!--根据peopleid查询个人学生信息-->
    <select id="getStuInform" resultType="Student">
        <include refid="baseSql"></include>
        FROM student s
        WHERE stuId = #{peopleId}
    </select>
    <!-- List<Student> getStu(long deptId)
    <根据deptId查询学生个人信息-->
    <!--林崑鹏-->
    <select id="getStu" resultType="Student">
        <include refid="baseSql"></include>
        from student s
        where s.deptId = #{deptId}
    </select>

    <!--List<Student> getStuByDeptId(@Param("page") int page, @Param("limit") int limit, @Param("deptId") long deptId)-->
    <!--根据部门id查询所有学生的姓名和毕业班级-->
    <!--林崑鹏-->
    <select id="getStuByDeptId" resultMap="stuList">
        SELECT
            s.stuId,
            s.stuName,
            s.deptId,
            s.sex,
            c.className
        FROM
            student s
        JOIN class c ON s.classId = c.classId
        WHERE
            s.deptId = #{deptId}
        <if test="stuName != null">
           AND s.stuName LIKE concat('%',#{stuName},'%')
        </if>
        LIMIT #{page}, #{limit}
    </select>
    <resultMap id="stuList" type="Student">
        <id column="stuId" property="stuId"></id>
        <result column="stuName" property="stuName"></result>
        <result column="classId" property="classId"></result>
        <result column="deptId" property="deptId"></result>
        <result column="sex" property="sex"></result>
        <collection property="aClass" javaType="Class">
            <result column="className" property="className"></result>
        </collection>
    </resultMap>
</mapper>